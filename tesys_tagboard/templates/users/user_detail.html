{% extends "account/base_entrance.html" %}

{% load static component_tags %}

{% block title %}
  User:
  {{ object.username }}
{% endblock title %}
{% block content %}
  {% include "heading.html" with text="PROFILE" %}
  <div class="w-full xl:max-w-screen">
    <div class="tabs">
      <label id="account-tab" class="flex gap-2 items-center text-lg tab group">
        <input type="radio"
               name="profile_tabs"
               value="account"
               {% if not tab or tab == "account" %}checked{% endif %} />
        <div class="flex gap-2 items-center">
          {% include "icons/feather.html" with icon="user" %}
          <div class="hidden sm:block group-has-[input:checked]:block">Account</div>
        </div>
      </label>
      <div class="p-6 rounded-none tab-content lg:bg-base-200">
        <div>
          <div>
            <h2>{{ user.username }}</h2>
            {% if user.name %}<p>{{ user.name }}</p>{% endif %}
          </div>
        </div>
        {% if user == request.user %}
          <!-- Action buttons -->
          <div>
            <a class="btn btn-primary" href="{% url 'users:update' %}" role="button">My Info</a>
            <a class="btn btn-primary"
               href="{% url 'account_email' %}"
               role="button">E-Mail</a>
            <a class="btn btn-primary" href="{% url 'mfa_index' %}" role="button">MFA</a>
          </div>
          <!-- End Action buttons -->
        {% endif %}
      </div>
      {% if favorites_pager %}
        <label id="favorites-tab" class="flex gap-2 items-center text-lg tab group">
          <input type="radio"
                 name="profile_tabs"
                 value="favorites"
                 {% if tab == "favorites" %}checked{% endif %} />
          <div class="flex gap-2 items-center">
            {% include "icons/feather.html" with icon="heart" %}
            <div class="hidden sm:block group-has-[input:checked]:block">Favorites</div>
          </div>
        </label>
        <div class="rounded-none lg:p-6 tab-content lg:bg-base-200">
          <div class="flex flex-col gap-4">
            {% if favorites_pager.num_pages > 0 %}
              {% component "pager" with pager=favorites_pager page=favorites_page / %}
              <div class="flex flex-wrap gap-4 justify-center">{% component "post_gallery" posts=favorites_page / %}</div>
              {% component "pager" with pager=favorites_pager page=favorites_page / %}
            {% else %}
              <div class="text-lg italic">No favorites yet!</div>
            {% endif %}
          </div>
        </div>
      {% endif %}
      <label id="collection-tab" class="flex gap-2 items-center text-lg tab group">
        <input type="radio"
               name="profile_tabs"
               value="collections"
               {% if tab == "collections" %}checked{% endif %} />
        {% include "icons/feather.html" with icon="list" %}
        <div class="hidden sm:block group-has-[input:checked]:block">Collections</div>
      </label>
      <div class="p-3 rounded-none lg:p-6 tab-content lg:bg-base-200">
        <div class="flex flex-col gap-8 md:flex-row">
          <div class="grow-0">{% component "create_collection" / %}</div>
          {% partialdef collection-gallery inline %}
          <div id="user-collection-gallery"
               class="grid grid-cols-1 gap-4 w-full xl:grid-cols-2">
            {% if collections.count == 0 %}
              <div class="text-3xl italic opacity-75">No collections yet!</div>
            {% else %}
              {% for collection in collections %}
                {% component "collection_thumbnail" collection=collection %}
                {% fill "delete_button" %}
                <button type="submit"
                        class="w-20 btn btn-error"
                        hx-delete="{% url "delete-collection" collection_id=collection.pk %}"
                        hx-on="click"
                        hx-swap="outerHTML"
                        hx-target="#user-collection-gallery"
                        hx-confirm="Are you sure you want to delete this collection?">Delete</button>
              {% endfill %}
            {% endcomponent %}
          {% endfor %}
        {% endif %}
      </div>
    {% endpartialdef %}
  </div>
</div>
</div>
</div>
<script>
  let tab_buttons = document.querySelectorAll(".tabs input[name='profile_tabs']");
  tab_buttons.forEach(btn => {
    btn.addEventListener("click", e => {
      window.history.replaceState(null, "", `{{ request.path }}?tab=${btn.value}`)
    });
  });
</script>
{% endblock content %}
