{% extends "base.html" %}

{% load component_tags %}

{% block title %}
  {{ block.super }} â€” Upload
{% endblock title %}
{% block content %}
  <div class="hidden">
    <!--
    Dummy tag to load Tag-related JS. This is necessary for Tags to properly execute
    their click actions. Otherwise, tags loaded in via the `add_tagset` component
    won't be interactive
     -->
    {% component "tag" / %}
  </div>
  {% include "heading.html" with text="Upload" %}
  <div class="flex gap-4 justify-center">
    <form action="{% url 'upload' %}"
          method="post"
          enctype="multipart/form-data"
          class="flex flex-col gap-4 p-8 w-full lg:w-1/2 rounded-box bg-base-300 sm:min-w-[450px] lg:max-w-[800px]">
      {% csrf_token %}
      {{ form.non_field_errors }}
      <fieldset class="fieldset">
        <legend class="fieldset-legend">
          Pick a file<span class="text-warning">*</span>
        </legend>
        <input type="file" name="file" class="w-full file-input file-input-lg" />
        <label for="file" class="label">Supported file types: PNG, JPEG, BMP, GIF, WebP</label>
      </fieldset>
      <fieldset class="fieldset">
        <legend class="fieldset-legend">Title</legend>
        <input type="text" name="title" class="w-full input text-input" />
        <label class="label" for="title">Provide a meaningful title for the post</label>
      </fieldset>
      <fieldset class="fieldset">
        <legend class="fieldset-legend">Source</legend>
        <span class="relative">
          <input name="src_url"
                 type="url"
                 pattern="(https?:\/\/)?([a-zA-Z0-9]([a-zA-Z0-9\-].*[a-zA-Z0-9])?\.)+[a-zA-Z].*"
                 placeholder="https://"
                 value=""
                 title="Must be valid URL"
                 class="pl-8 w-full input validator" />
          <div class="grid absolute top-0 left-2 content-center h-full z-5">
            {% include "icons/feather.html" with icon="link" %}
          </div>
        </span>
        <label for="src_url" class="label">Provide a link to the original work</label>
        <p class="hidden validator-hint">Must be valid URL</p>
      </fieldset>
      <fieldset class="w-full fieldset">
        <legend class="fieldset-legend">Rating</legend>
        <select class="w-full select" name="rating_level">
          <option disabled selected value="1">Pick a rating level</option>
          {% for rating_level in rating_levels %}
            <option value="{{ rating_level.value }}">{{ rating_level.name }} ({{ rating_level.value }})</option>
          {% endfor %}
        </select>
      </fieldset>
      <div id="all-posts-tagset" class="flex">{% component "add_tagset" add_tag_enabled=True tags=default_tags / %}</div>
      <input type="submit" value="Post" class="text-xl btn btn-primary" />
      {% if form.errors %}
        <div role="alert" class="alert alert-error">
          {% include "icons/feather.html" with icon="alert-circle" %}
          {{ form.errors }}
        </div>
      {% endif %}
    </form>
  </div>
{% endblock content %}
